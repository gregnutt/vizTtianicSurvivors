<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<script src="http://d3js.org/d3.v3.min.js"></script>
		
		<style></style>

		<script type="text/javascript">
			function draw(data) {
			    /*
			      D3.js setup code
			    */
		        "use strict";
		        var margin = 75,
		            width = 1400 - margin,
		            height = 600 - margin;

		        var x = d3.scale.linear()
		          	  .domain([0, d3.max(data, function(d) { return d.Age; })])
		          	  .range([0, width]);

		        var y = d3.scale.linear()
		        	  .domain([])
		        	  .range([]);

		        var svg = d3.select("body")
		            .append("svg")
		              .attr("width", width + margin)
		              .attr("height", height + margin)
		            .append('g')
		                .attr('class','chart');

		        function data_trim(d, field, null_value) { 
		        	// Abstracted function to remove empty values from the dataset
		        	var null_entries = [];

		        	for (var i = 0; i < d.length; i++) {
		        		if (d[i][field] == null_value) {
		        			null_entries.push(i);
		        		}
		        	}
		        	for (var i = 0; i < null_entries.length; i++) {
		        		d.splice(null_entries[i]-i, 1);
		        	}

		        	return d;
		        }

		        // Remove any empty values for Age, Fare, and Embarked
		        data = data_trim(data, 'Age', 0);
		        data = data_trim(data, 'Fare', 0);
		        data = data_trim(data, 'Embarked', "");

		        // Bin Passengers by age group
		        for (var i = 0; i < data.length; i++) {
	        		if (data[i].Age < 10) {
				  		data[i].AgeRange = '<10 Years';
	        		}
				  	else if (data[i].Age >= 10 && data[i].Age < 20) {
				  		data[i].AgeRange = '10 to 20 Years';
				  	}
				  	else if (data[i].Age >= 20 && data[i].Age < 30) {
				  		data[i].AgeRange = '20 to 30 Years';
				  	}
				  	else if (data[i].Age >= 30 && data[i].Age < 40) {
				  		data[i].AgeRange = '30 to 40 Years';
				  	}
				  	else if (data[i].Age >= 40 && data[i].Age < 50) {
				  		data[i].AgeRange = '40 to 50 Years';
				  	}
				  	else if (data[i].Age >= 50 && data[i].Age < 60) {
				  		data[i].AgeRange = '50 to 60 Years';
				  	}
				  	else if (data[i].Age >= 60) {
				  		data[i].AgeRange = '60+ Years'; 
				  	}
		        }

		        var setupStack = function setupStack(data){
		       	// Function to split bar above and below xAxis
		        	for (var i = 0; i < data.length; i++) {
		        		// Above Axis
		        		var baseSurvived = 0;
		        		// Below Axis
		        		var baseDied = 0;

		        		for (var j = 0; j < data[i][j].length; j++) {
		        			// For each item in the group
		        			stackItem = data[i][j];

		        			if (stackItem.Survived === 0) {
		        				stackItem.y0 = baseDied;
		        				baseDied -= 1;
		        			} else if (stackItem.Survived === 1) {
		        				baseSurvived += 1;
		        				stackItem.y0 = baseSurvived;
		        			}
		        		}
		        	}

		        	return data;
		        };



			}
		</script>
	</head>
	<body>
		<script type="text/javascript">
			// load the dataset
			d3.csv('titanic_survivors.csv', function(d) {
				d.Survived = +d.Survived;
				d.Age = +d.Age;
				d.SibSp = +d.SibSp;
				d.Parch = +d.Parch;
				d.Fare = +d.Fare;
				switch (d.Embarked) {
				  	case 'C':
				  		d.Embarked = 'Cherbourg, France';
				  	case 'Q':
				  		d.Embarked = 'Queenstown, Ireland';
				  	case 'S':
						d.Embarked = 'Southampton, UK';
				}
			    return d;
			}, draw);
		</script>
	</body>
</html>